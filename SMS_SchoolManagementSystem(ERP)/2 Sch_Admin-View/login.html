<!DOCTYPE html>
<html lang="en" class="h-full scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <title>School Admin Login - School Management System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          fontFamily: { 
            sans: ['Plus Jakarta Sans', 'Inter', 'system-ui', 'sans-serif'],
            mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'monospace']
          },
          colors: {
            brand: { 50: '#dcfce7', 100: '#bbf7d0', 500: '#22c55e', 600: '#16a34a', 700: '#15803d', 900: '#14532d' },
            dark: { 800: '#1e293b', 900: '#0f172a', 950: '#020617' }
          },
          animation: {
            'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
            'slide-in': 'slideIn 0.4s ease-out forwards',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeInUp: {
              '0%': { opacity: '0', transform: 'translateY(15px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            slideIn: {
              '0%': { opacity: '0', transform: 'translateX(-10px)' },
              '100%': { opacity: '1', transform: 'translateX(0)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    *:focus-visible { outline: 2px solid #22c55e; outline-offset: 2px; }
    
    /* Glassmorphism utilities */
    .glass {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .dark .glass {
      background: rgba(15, 23, 42, 0.6);
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 text-slate-800 antialiased dark:from-slate-900 dark:to-slate-800 dark:text-slate-200 transition-colors duration-300 flex items-center justify-center p-4">
  <div class="w-full max-w-md animate-fade-in-up px-4 sm:px-6 lg:pl-4">
    <div class="glass backdrop-blur-xl border border-white/20 dark:border-slate-700/50 rounded-3xl shadow-2xl p-8 md:p-10">
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-brand-500 to-emerald-600 rounded-2xl mb-4 shadow-lg">
          <i class="fas fa-user-tie text-white text-2xl"></i>
        </div>
        <h1 class="text-3xl font-extrabold text-slate-900 dark:text-white mb-2">School Admin</h1>
        <p class="text-slate-600 dark:text-slate-400">Principal / Management Access</p>
      </div>

      <form id="loginForm" class="space-y-6">
        <div>
          <label for="phone" class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2 flex items-center gap-2">
            <i class="fas fa-phone text-brand-500"></i>Phone Number
          </label>
          <input type="tel" id="phone" name="phone" required
            class="w-full px-4 py-3.5 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all bg-white dark:bg-slate-800/50 text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-500"
            placeholder="+91 9876543210">
        </div>

        <div>
          <label for="otp" class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2 flex items-center gap-2">
            <i class="fas fa-key text-brand-500"></i>OTP / Password
          </label>
          <div class="flex gap-2">
            <input type="text" id="otp" name="otp" required
              class="flex-1 px-4 py-3.5 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all bg-white dark:bg-slate-800/50 text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-500"
              placeholder="Enter OTP or Password">
            <button type="button" onclick="sendOTP()" class="bg-gradient-to-r from-brand-500 to-emerald-600 hover:from-brand-600 hover:to-emerald-700 text-white px-4 py-3.5 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all active:scale-95 whitespace-nowrap flex items-center gap-1.5">
              <i class="fas fa-paper-plane"></i>
              <span class="hidden sm:inline">Send OTP</span>
            </button>
          </div>
        </div>

        <div class="flex items-center justify-between">
          <label class="flex items-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-600 focus:ring-brand-500 bg-white dark:bg-slate-800">
            <span class="ml-2 text-sm font-medium text-slate-600 dark:text-slate-400">Remember me</span>
          </label>
          <a href="#" class="text-sm font-bold text-brand-600 hover:text-brand-700 dark:text-brand-400 dark:hover:text-brand-300 transition-colors">Forgot password?</a>
        </div>

        <button type="submit" class="w-full bg-gradient-to-r from-brand-500 to-emerald-600 hover:from-brand-600 hover:to-emerald-700 text-white py-3.5 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all active:scale-95 flex items-center justify-center gap-2">
          <i class="fas fa-sign-in-alt"></i>
          <span>Sign In</span>
        </button>
      </form>

      <div class="mt-6 text-center">
        <a href="../index.html" class="text-sm font-bold text-slate-600 hover:text-brand-600 dark:text-slate-400 dark:hover:text-brand-400 transition-colors flex items-center justify-center gap-1.5">
          <i class="fas fa-arrow-left"></i>
          <span>Back to Home</span>
        </a>
      </div>
      
      <!-- Theme Toggle -->
      <div class="mt-6 flex justify-center">
        <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">
          <i class="fas fa-moon dark:hidden"></i>
          <i class="fas fa-sun hidden dark:block text-amber-400"></i>
        </button>
      </div>
    </div>
  </div>

    <script src="../js/utils.js"></script>
    <script src="../js/theme-manager.js"></script>
    <script>
        'use strict';

        // Initialize dark mode
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial theme based on localStorage or system preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else if (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        });

        async function sendOTP() {
            const phoneInput = document.getElementById('phone');
            const phone = phoneInput.value.trim();

            if (!phone) {
                if (typeof NotificationManager !== 'undefined') {
                    NotificationManager.warning('Please enter your phone number first');
                } else {
                    alert('Please enter your phone number first');
                }
                phoneInput.focus();
                return;
            }

            const otpButton = event.target.closest('button');
            if (otpButton) {
                const originalText = otpButton.innerHTML;
                otpButton.disabled = true;
                otpButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

                try {
                    // Simulate API call with real-time data fetching
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    if (typeof NotificationManager !== 'undefined') {
                        NotificationManager.success(`OTP sent to ${phone}`);
                    } else {
                        alert(`OTP sent to ${phone}`);
                    }
                } catch (error) {
                    if (typeof NotificationManager !== 'undefined') {
                        NotificationManager.error('Failed to send OTP. Please try again.');
                    } else {
                        alert('Failed to send OTP. Please try again.');
                    }
                } finally {
                    otpButton.disabled = false;
                    otpButton.innerHTML = originalText;
                }
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const phone = document.getElementById('phone').value.trim();
            const otp = document.getElementById('otp').value.trim();

            if (!phone || !otp) {
                if (typeof NotificationManager !== 'undefined') {
                    NotificationManager.warning('Please enter both phone number and OTP/Password');
                } else {
                    alert('Please enter both phone number and OTP/Password');
                }
                return;
            }

            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                const credentials = { phone: phone, password: otp };
                let response;
                
                // Real-time data fetching with error handling
                if (typeof ApiService !== 'undefined') {
                    response = await ApiService.login('school-admin', credentials);
                } else {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    const validCredentials = { phone: '+91 9876543210', password: '123456' };
                    
                    const normalizePhone = (phone) => {
                        if (!phone) return '';
                        let normalized = phone.replace(/[\s\-\(\)]/g, '');
                        normalized = normalized.replace(/^\+91/, '').replace(/^91/, '');
                        normalized = normalized.replace(/^0/, '');
                        return normalized;
                    };
                    
                    const enteredPhone = normalizePhone(credentials.phone);
                    const validPhone = normalizePhone(validCredentials.phone);
                    const isValid = enteredPhone === validPhone && credentials.password === validCredentials.password;
                    
                    if (!isValid && enteredPhone.length >= 10) {
                        const last10Entered = enteredPhone.slice(-10);
                        const last10Valid = validPhone.slice(-10);
                        if (last10Entered === last10Valid && credentials.password === validCredentials.password) {
                            response = {
                                success: true,
                                user: {
                                    id: 'SCHADM001',
                                    name: 'Principal John Doe',
                                    phone: credentials.phone,
                                    school: 'Greenwood High School',
                                    role: 'school-admin'
                                },
                                token: 'mock_jwt_token_' + Date.now()
                            };
                        } else {
                            throw new Error('Invalid credentials');
                        }
                    } else if (isValid) {
                        response = {
                            success: true,
                            user: {
                                id: 'SCHADM001',
                                name: 'Principal John Doe',
                                phone: credentials.phone,
                                school: 'Greenwood High School',
                                role: 'school-admin'
                            },
                            token: 'mock_jwt_token_' + Date.now()
                        };
                    } else {
                        throw new Error('Invalid credentials');
                    }
                }

                if (!response || !response.success || !response.user) {
                    throw new Error('Login failed. Please try again.');
                }

                // Set session with real-time data
                if (typeof SessionManager !== 'undefined') {
                    SessionManager.setSession('school-admin', response.user);
                } else {
                    const session = {
                        role: 'school-admin',
                        userData: response.user,
                        loginTime: new Date().toISOString(),
                        expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()
                    };
                    localStorage.setItem('userSession', JSON.stringify(session));
                    localStorage.setItem('isAuthenticated', 'true');
                }

                if (typeof NotificationManager !== 'undefined') {
                    NotificationManager.success('Login successful! Redirecting...');
                } else {
                    alert('Login successful! Redirecting...');
                }

                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 500);

            } catch (error) {
                submitButton.disabled = false;
                submitButton.innerHTML = originalText;
                const errorMessage = error.message || 'Invalid credentials. Please try again.';
                if (typeof NotificationManager !== 'undefined') {
                    NotificationManager.error(errorMessage);
                } else {
                    alert(errorMessage);
                }
                document.getElementById('otp').value = '';
            }
        });
    </script>
</body>
</html>

